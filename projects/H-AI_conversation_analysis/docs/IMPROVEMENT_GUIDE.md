# 여행사 AI 챗봇 개선 가이드

본 문서는 AI 챗봇 대화 로그 분석 결과를 바탕으로 **RAG 강화**, **프롬프트 튜닝**, **피드백 루프**를 어떻게 설계·운영할지 상세히 정리한 가이드입니다.

---

## 1. 개요

- **목적**: 고객 만족도 향상, 오답률·불만 감소, 유지보수 효율화.
- **입력**: 대화 로그 CSV(날짜, 질문, 답변, 분류, 카테고리, 평가결과, 오답사유 등).
- **산출물**: 질문 유형·키워드 통계, 불만/부정 키워드·원인 분류, RAG/프롬프트/피드백 권고.

---

## 2. 질문 유형·키워드 분석 활용

### 2.1 카테고리별 건수·비중

- **용도**: 어떤 문의 유형이 많은지 파악 → RAG 문서와 프롬프트 우선순위 결정.
- **활용**:
  - 상위 카테고리(상품 추천, 예약/확정, 결제/환불, 일정추천 등)에 대해서는:
    - RAG: 해당 도메인 FAQ, 상품/정책 문서를 우선 지식베이스에 반영.
    - 검색 시 카테고리(또는 분류) 필터를 적용해 관련 청크만 검색.
  - 비중이 낮지만 오답률이 높은 카테고리는 “니치 but 중요”로 별도 개선 태스크.

### 2.2 키워드별 출현 건수

- **용도**: 고객이 실제로 쓰는 단어를 반영한 인덱싱·동의어 확장.
- **활용**:
  - 고빈도 키워드(예: 상품, 예약, 출발, 도쿄, 오키나와, 결제, 취소 등):
    - RAG 청크 메타데이터에 해당 키워드/태그 부여, 검색 가중치 조정.
    - 동의어·유사표현 매핑(예: “예약확정” ↔ “출발확정”, “예약대기” 등) 추가.
  - 키워드 기반으로 “자주 묻는 질문” 리스트를 주기적으로 갱신하고, RAG와 프롬프트 예시에 반영.

---

## 3. 불만/부정 키워드 및 원인 분류

### 3.1 “AI 답변 불만” vs “챗봇에 대한 화풀이” 구분

- **AI 답변 불만**: 챗봇이 질문을 잘못 이해했거나, 엉뚱한/불충분한 답을 줘서 생기는 불만.
  - **오답사유 패턴 예**: “질문에 대한 직접적인 답변을 제공하지 않았습니다”, “질문과 관련이 없습니다”, “질문의 의도를 파악하기 어렵습니다”, “구체적인 정보가 제공되지 않았습니다”.
  - **대응**: RAG 보강(해당 주제 문서 추가), 프롬프트에서 “먼저 질문에 직접 답한 뒤 보조 설명” 규칙 강화, 의도 불명 시 선택지/가정 확인 문구 추가.

- **화풀이/기타 불만**: 예약·결제·항공사·호텔 등 서비스 자체에 대한 불만을 챗봇 창에 적는 경우.
  - **오답사유 패턴 예**: 고객센터 연락 안내, 특정 여행사/상품 정책만 설명 등.
  - **대응**: “이건 챗봇이 해결할 수 있는 범위가 아니다”를 명확히 안내하고, 고객센터/1:1 문의로 유도하는 프롬프트 정리. 동시에 해당 유형 문의는 별도 집계해 운영팀에 전달.

### 3.2 원인별 대응 표

| 원인 유형           | 설명                     | 대응 방향 |
|--------------------|--------------------------|-----------|
| AI 답변 품질/직접 답변 부재 | 의도 불일치, 관련 없는 답변 | RAG·프롬프트·few-shot 강화 |
| 기타/고객센터 연락 등   | 챗봇 외 이슈, 상담 요청     | 안내 문구 표준화, 에스컬레이션 루트 명시 |
| 기타/불명확          | 의도 파악 어려움, 짧은/비문 질문 | “다음 중 어떤 문의인가요?” 선택지, 가정 후 확인 |

---

## 4. RAG 강화

### 4.1 문서 구성

- **필수 문서 유형**
  - 하나투어(또는 해당 여행사) FAQ: 예약/취소/변경, 결제/환불, 예약확정/예약대기, 발권, 비자 등.
  - 상품/정책: 패키지/자유여행 조건, 노팁/세이브 스탠다드 등 용어 설명, 무이자 할부 등 이벤트 정책.
  - 지역/상품 정보: 인기 여행지(도쿄, 오키나와, 다낭 등) 요약, 상품 검색 조건(출발지, 기간, 테마) 설명.

- **청크 전략**
  - 질문 유형(카테고리/분류)별로 메타데이터 태깅 → 검색 시 필터링.
  - 고빈도 키워드를 제목/요약/키워드 필드에 포함해 검색 정확도 향상.
  - 동의어·유사표현은 검색 쿼리 확장 또는 별도 필드로 매핑.

### 4.2 검색 파이프라인

- **쿼리**: 사용자 질문 + (선택) 이전 턴 문맥.
- **필터**: 가능하면 “카테고리” 또는 “분류”를 먼저 추론한 뒤, 해당 태그가 붙은 청크만 검색하거나 가중치 부여.
- **재순위**: 키워드 일치도, 날짜(최신 정책 우선) 등을 반영한 재순위 모델 적용 권장.

### 4.3 주기적 갱신

- 주 1회 이상: 신규 FAQ·정책 변경분 반영.
- 월 1회: 대화 로그 기반 “자주 묻는 질문”·키워드 리스트 갱신 후 RAG 문서/메타데이터 업데이트.

---

## 5. 프롬프트 튜닝

### 5.1 공통 규칙

- **직접 답변 우선**  
  “질문에 대해 한 문장으로 Yes/No 또는 구체적 답을 먼저 제시한 뒤, 필요 시 보조 설명을 이어가라.”
- **범위 밖 문의**  
  “여행/예약/상품 관련이 아니거나, 개인 예약 조회·결제 취소 등 개인정보가 필요한 경우, 챗봇으로는 한계가 있음을 안내하고 고객센터/1:1 문의로 유도하라.”
- **의도 불명확**  
  “질문이 짧거나 모호하면 ‘다음 중 어떤 문의인가요?’ 선택지를 주거나, ‘~로 이해했습니다. 맞다면 …’ 형태로 가정을 밝힌 뒤 답변하라.”

### 5.2 카테고리별 지시

- 오답이 많은 카테고리(상품 추천, 예약/확정, 결제/환불, 일정추천 등)마다:
  - **시스템 지시**: “이 대화는 [카테고리] 문의이다. 반드시 [해당 유형]에 맞는 형식과 내용으로 답변하라.”
  - **Few-shot**: 해당 카테고리의 “질문–올바른 답변” 예시 2~3쌍을 프롬프트에 포함.

### 5.3 금지/제한 사항

- “질문과 무관한 일반론만 하지 말 것.”
- “특정 여행사/상품만 언급하지 말고, 질문이 일반 개념(예: 예약대기, 발권)을 묻는 경우 일반 설명을 먼저 한 뒤, 필요 시 해당 사이트 확인을 안내할 것.”

---

## 6. 피드백 루프

### 6.1 수집

- **대상**: 평가결과(정답/오답), 오답사유, 질문, 답변, (가능하면) 세션/챗룸 ID.
- **주기**: 최소 주 1회, 가능하면 일 단위로 수집해 분석 파이프라인에 투입.

### 6.2 자동 분석

- **실행**: `run_analysis.py` (또는 동일 로직 배치)로 주기 실행.
- **산출물**:  
  - 질문 유형·키워드 통계  
  - 오답 원인 분류(AI 품질 vs 기타/화풀이 vs 불명확)  
  - 카테고리별 오답 분포  
  - 부정 키워드 빈도  

### 6.3 오답 유형 태깅

- 오답사유를 다음처럼 태그화해 저장:
  - `의도_불일치`: 질문 의도와 다른 답변
  - `정보_부재`: RAG/지식에 없어서 못 답함
  - `범위_밖`: 고객센터/전화 문의가 적합한 경우
  - `질문_불명확`: 짧은/비문 등으로 의도 파악 어려움
  - `시스템_오류`: 타임아웃, 검색 실패 등

→ 주간/월간으로 태그별 건수 추이를 보고, RAG·프롬프트 개선 우선순위에 반영.

### 6.4 대시보드 연동

- 시각화 항목 예:
  - 일/주별 정답률·오답률
  - 카테고리별 오답 건수·비율
  - 원인 유형별 비율
  - 부정 키워드 트렌드
- “AI 답변 불만” 비율이 올라가면 즉시 프롬프트/RAG 점검 트리거.

### 6.5 A/B 테스트

- 프롬프트·RAG 변경 시:
  - 트래픽의 일부(예: 10%)만 새 버전 적용.
  - 정답률, 이탈률, 대화 길이 등을 비교해 통계적 유의성 확인 후 전면 적용 여부 결정.

---

## 7. 실행 방법

```bash
# 가상환경 권장
python -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install -r requirements.txt

# 분석 실행 (기본 CSV: 20260205_26033건.csv)
python run_analysis.py

# 다른 CSV 지정
python run_analysis.py /path/to/other_log.csv
```

- **결과 파일**
  - `analysis_report.json`: 전체 분석 결과(질문 유형, 불만/원인, 개선 권고).
  - `analysis_summary.txt`: 요약 텍스트.
- **상세 가이드**: 본 문서(`docs/IMPROVEMENT_GUIDE.md`)와 `analysis_report.json`의 “개선_권고”를 함께 참고해 RAG·프롬프트·피드백 루프 작업 계획을 수립하면 된다.

---

## 8. 체크리스트 (주간/월간)

- [ ] 대화 로그 수집 및 분석 스크립트 실행
- [ ] 오답 원인 분류 비율 확인 (AI 품질 vs 기타)
- [ ] 오답률 상위 카테고리 3개에 대한 RAG·프롬프트 점검
- [ ] 고빈도 키워드·신규 FAQ 반영 여부
- [ ] 부정 키워드 트렌드 확인 및 이슈 에스컬레이션
- [ ] 변경 사항 적용 시 A/B 테스트 수행 여부
